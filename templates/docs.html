<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PartyAux API Documentation</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0a0a;        /* near-black */
      --fg:#f7f7f7;        /* near-white */
      --muted:#bdbdbd;     /* mid-gray */
      --edge:#1a1a1a;      /* card bg */
      --border:#222;       /* subtle borders */
      --accent:#fff;       /* pure white accents */
      --shadow: 0 10px 30px rgba(0,0,0,.5);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:var(--bg);
      color:var(--fg);
      line-height:1.5;
      -webkit-font-smoothing:antialiased;
    }
    .container{max-width:1100px;margin:0 auto;padding:36px 20px 64px}
    header{
      display:flex;gap:18px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;margin-bottom:28px
    }
    .title{
      font-size: clamp(28px, 3.2vw, 44px);
      font-weight:700;letter-spacing:-0.02em
    }
    .subtitle{color:var(--muted);max-width:720px;margin-top:6px}

    .panel{
      background:linear-gradient(180deg, #0d0d0d, #0a0a0a);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }

    .grid{
      display:grid;grid-template-columns:1.1fr .9fr;gap:18px
    }
    @media (max-width: 980px){.grid{grid-template-columns:1fr;}}

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .input, .select, .button{
      background:#0f0f0f;color:var(--fg);
      border:1px solid var(--border);border-radius:12px;
      padding:12px 14px;font-size:14px
    }
    .input{flex:1;min-width:200px}
    .select{min-width:220px}
    .button{cursor:pointer}
    .button:hover{filter:brightness(1.15)}

    .pill{font-size:12px;padding:4px 10px;border:1px solid var(--border);border-radius:999px;color:var(--muted)}

    details.endpoint{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:var(--edge)}
    details.endpoint+details.endpoint{margin-top:12px}
    summary{
      list-style:none;cursor:pointer;padding:18px 18px;display:grid;grid-template-columns:120px 1fr auto;gap:12px;align-items:center
    }
    summary::-webkit-details-marker{display:none}
    .method{
      font-weight:700;text-align:center;min-width:100px;padding:6px 12px;border:1px solid var(--border);border-radius:999px
    }
    .GET{background:rgba(255,255,255,0.04)}
    .POST{background:rgba(255,255,255,0.08)}
    .path{font-weight:600}
    .chev{opacity:.6}

    .content{padding:0 18px 18px}
    .section{padding:14px 0;border-top:1px solid var(--border)}
    .section h4{margin:0 0 10px 0;font-size:14px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase}

    code, pre{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    pre{margin:0;background:#0f0f0f;border:1px solid var(--border);border-radius:14px;padding:14px;overflow:auto}
    .kvs{display:flex;flex-wrap:wrap;gap:8px}
    .kv{background:#0f0f0f;border:1px solid var(--border);border-radius:10px;padding:8px 10px;font-size:13px}

    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:800px){.two-col{grid-template-columns:1fr}}

    .copy{
      margin-left:8px;border:1px solid var(--border);border-radius:8px;background:#121212;color:var(--fg);padding:6px 10px;cursor:pointer;font-size:12px
    }
    .copy:active{transform:translateY(1px)}

    footer{margin-top:24px;color:var(--muted);font-size:12px;text-align:center}

    .badge{border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}

    .divider{height:1px;background:var(--border);margin:10px 0}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <div class="title">PartyAux API</div>
        <div class="subtitle">Minimal, clean, black & white docs for your Flask + Socket.IO backend. Use the base URL, expand endpoints, copy cURL/fetch examples, and go.</div>
      </div>
      <div class="row">
        <span class="pill">Font: Space Grotesk</span>
        <span class="pill">Theme: Monochrome</span>
      </div>
    </header>

    <div class="grid">
      <section class="panel">
        <div class="row" style="gap:12px;align-items:flex-end">
          <div style="flex:1">
            <label class="pill" style="display:block;margin-bottom:8px">Base URL</label>
            <input class="input" id="baseUrl" value="http://35.208.64.59" />
          </div>
          <div>
            <label class="pill" style="display:block;margin-bottom:8px">JWT (optional)</label>
            <input class="input" id="jwtInput" placeholder="Paste JWT for examples" />
          </div>
        </div>
        <div class="divider"></div>
        <div class="row" style="gap:12px">
          <input id="search" class="input" placeholder="Search endpoints… (path, method, param)" />
          <select id="filterMethod" class="select">
            <option value="">All methods</option>
            <option>GET</option>
            <option>POST</option>
          </select>
          <button id="expandAll" class="button">Expand all</button>
          <button id="collapseAll" class="button">Collapse all</button>
        </div>
      </section>

      <aside class="panel">
        <div class="row" style="justify-content:space-between">
          <div class="pill">Quick Tips</div>
          <div class="badge" id="countBadge">0 endpoints</div>
        </div>
        <ul style="margin:12px 0 0 16px; padding:0 0 0 8px; line-height:1.9; color:var(--muted)">
          <li>Most write actions are <b>POST</b> with JSON bodies. Read actions are <b>GET</b>.</li>
          <li>Authenticated routes expect <code>jwt</code> in the JSON body.</li>
          <li>Room operations generally include <code>room</code> or <code>room_code</code> parameter.</li>
          <li>Song objects use <code>artist</code>, <code>album</code>, <code>title</code>, <code>url</code> (video ID), and <code>album_art</code>.</li>
          <li>Playlist endpoints include <code>playlist_id</code> or are scoped to the authenticated user.</li>
        </ul>
        
        <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border)">
          <div class="pill" style="margin-bottom:8px">Socket.IO Example</div>
          <pre style="font-size:11px;overflow-x:auto"><code>// Connect to Socket.IO
const socket = io('http://35.208.64.59');

// Join a room
socket.emit('join_room', {
  room: 'ABCD123',
  jwt: 'your-jwt-token'
});

// Listen for events
socket.on('add_song', (data) => {
  console.log('Song added:', data.song);
});

socket.on('current_song', (data) => {
  console.log('Now playing:', data.song);
});</code></pre>
        </div>
      </aside>
    </div>

    <main id="endpoints" style="margin-top:18px"></main>

    <!-- Socket.IO Events Section -->
    <section style="margin-top:36px">
      <div class="panel">
        <div class="row" style="justify-content:space-between;margin-bottom:16px">
          <h2 style="margin:0;font-size:24px;font-weight:600">Socket.IO Events</h2>
          <div class="badge">Real-time Communication</div>
        </div>
        
        <div class="grid" style="margin-top:18px">
          <!-- Incoming Events (Client to Server) -->
          <div class="panel" style="background:var(--edge)">
            <h3 style="margin:0 0 16px 0;font-size:18px;color:var(--accent)">📤 Incoming (Client → Server)</h3>
            
            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(0,150,255,0.1);color:#0096ff">LISTEN</div>
                <div class="path">connect</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Triggered when a client connects to the server.</p>
                  <h4>Data</h4>
                  <pre><code>// No data required</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(0,150,255,0.1);color:#0096ff">LISTEN</div>
                <div class="path">disconnect</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Triggered when a client disconnects from the server.</p>
                  <h4>Data</h4>
                  <pre><code>// No data required</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(0,150,255,0.1);color:#0096ff">LISTEN</div>
                <div class="path">join_room</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Join a specific room for real-time updates.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "room": "ABCD123",
  "jwt": "your-jwt-token"
}</code></pre>
                  <h4>Response Events</h4>
                  <ul style="color:var(--muted);margin:8px 0 0 16px">
                    <li><code>server_message</code> - Confirmation message</li>
                    <li><code>someone_joined</code> - Broadcast to room members</li>
                  </ul>
                </div>
              </div>
            </details>

            <details class="endpoint">
              <summary>
                <div class="method" style="background:rgba(0,150,255,0.1);color:#0096ff">LISTEN</div>
                <div class="path">leave_room</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Leave the current room.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "jwt": "your-jwt-token"
}</code></pre>
                  <h4>Response Events</h4>
                  <ul style="color:var(--muted);margin:8px 0 0 16px">
                    <li><code>server_message</code> - Confirmation message</li>
                    <li><code>someone_left</code> - Broadcast to room members</li>
                  </ul>
                </div>
              </div>
            </details>
          </div>

          <!-- Outgoing Events (Server to Client) -->
          <div class="panel" style="background:var(--edge)">
            <h3 style="margin:0 0 16px 0;font-size:18px;color:var(--accent)">📥 Outgoing (Server → Client)</h3>
            
            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">add_song</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Emitted when a song is added to the queue.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "song": {
    "uuid": "550e8400-e29b-41d4-a716-446655440001",
    "artist": "The Beatles",
    "album": "Abbey Road",
    "duration": "3:03",
    "title": "Come Together",
    "url": "jjoNDRXAJlI",
    "album_art": "https://lh3.googleusercontent.com/...",
    "added_by": "username",
    "downvotes": []
  }
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">remove_song</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Emitted when a song is removed from the queue.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "song": "550e8400-e29b-41d4-a716-446655440001"
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">delete_head_song</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Emitted when the current song is skipped.</p>
                  <h4>Data</h4>
                  <pre><code>{}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">current_song</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Emitted when the current song changes.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "song": {
    "uuid": "550e8400-e29b-41d4-a716-446655440001",
    "artist": "The Beatles",
    "album": "Abbey Road",
    "duration": "3:03",
    "title": "Come Together",
    "url": "jjoNDRXAJlI",
    "album_art": "https://lh3.googleusercontent.com/...",
    "added_by": "username",
    "downvotes": ["user1@example.com"]
  }
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">downvote</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Emitted when a song receives a downvote.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "song": "550e8400-e29b-41d4-a716-446655440001",
  "downvotes": 2
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">delete_song_from_queue</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Emitted when a song is automatically removed due to too many downvotes.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "uuid": "550e8400-e29b-41d4-a716-446655440001"
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">host_playing_only_changed</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Emitted when the host changes the "host playing only" setting.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "room_code": "ABCD123",
  "host_playing_only": true
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">server_message</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">General server messages sent to specific clients.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "message": "Joined room ABCD123"
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint" style="margin-bottom:12px">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">someone_joined</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Broadcast when someone joins the room.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "room": "ABCD123",
  "email": "user@example.com"
}</code></pre>
                </div>
              </div>
            </details>

            <details class="endpoint">
              <summary>
                <div class="method" style="background:rgba(255,150,0,0.1);color:#ff9600">EMIT</div>
                <div class="path">someone_left</div>
                <div class="chev">▾</div>
              </summary>
              <div class="content">
                <div class="section">
                  <h4>Description</h4>
                  <p style="color:var(--muted)">Broadcast when someone leaves the room.</p>
                  <h4>Data</h4>
                  <pre><code>{
  "room": "ABCD123",
  "email": "user@example.com"
}</code></pre>
                </div>
              </div>
            </details>
          </div>
        </div>

        <div class="section" style="margin-top:20px">
          <h4>Socket.IO Usage Notes</h4>
          <ul style="margin:8px 0 0 16px;color:var(--muted);line-height:1.7">
            <li>Connect to the Socket.IO server at the same base URL as the REST API</li>
            <li>Use <code>join_room</code> with a valid JWT to receive room-specific events</li>
            <li>All room events are automatically broadcast to all members in that room</li>
            <li>Songs are automatically removed from queue when downvotes reach the max threshold</li>
            <li>The current song updates automatically when skipped or when queue progresses</li>
            <li>Room state changes (like host_playing_only) are broadcast in real-time</li>
          </ul>
        </div>
      </div>
    </section>

    <footer>
      Built with ❤ in monochrome. Drop this file anywhere static hosting is allowed.
    </footer>
  </div>

  <script>
    // ---- Endpoint data (corrected to match actual API) ----
    const ENDPOINTS = [
      { path: "/", methods:["GET"], params: [] },
      { path: "/docs", methods:["GET"], params: [] },
      { path: "/search/<query>", methods:["GET"], params:[["path","query"]] },
      { path: "/search/suggestions/<query>", methods:["GET"], params:[["path","query"]] },
      { path: "/search-playlists/<playlist_name>", methods:["GET"], params:[["path","playlist_name"]] },
      { path: "/send-otp", methods:["POST"], params:[["json","email"]] },
      { path: "/login", methods:["POST"], params:[["json","email"],["json","otp"]] },
      { path: "/exists", methods:["POST"], params:[["json","jwt"]] },
      { path: "/create-signup", methods:["POST"], params:[["json","jwt"],["json","username"]] },
      { path: "/create-room", methods:["POST"], params:[["json","jwt"],["json","max_downvotes"]] },
      { path: "/add-song-to-queue", methods:["POST"], params:[["json","room"],["json","song"],["json","jwt"]] },
      { path: "/remove-song-from-queue", methods:["POST"], params:[["json","room"],["json","song_uuid"],["json","jwt"]] },
      { path: "/next-song", methods:["POST"], params:[["json","room"],["json","jwt"]] },
      { path: "/get-queue", methods:["POST"], params:[["json","room"],["json","jwt"]] },
      { path: "/get-current-song", methods:["POST"], params:[["json","room"],["json","jwt"]] },
      { path: "/add-downvote", methods:["POST"], params:[["json","room"],["json","song_uuid"],["json","jwt"]] },
      { path: "/get-room-info", methods:["POST"], params:[["json","room"],["json","jwt"]] },
      { path: "/change-max-downvotes", methods:["POST"], params:[["json","room"],["json","max_downvotes"],["json","jwt"]] },
      { path: "/create-playlist", methods:["POST"], params:[["json","jwt"],["json","name"]] },
      { path: "/get-playlist-info", methods:["POST"], params:[["json","jwt"],["json","playlist_id"]] },
      { path: "/get-user-playlists", methods:["POST"], params:[["json","jwt"]] },
      { path: "/update-playlist", methods:["POST"], params:[["json","jwt"],["json","playlist_id"],["json","songs"]] },
      { path: "/change-playlist-visibility", methods:["POST"], params:[["json","jwt"],["json","playlist_id"],["json","public"]] },
      { path: "/change-host-playing-only", methods:["POST"], params:[["json","jwt"],["json","room_code"],["json","host_playing_only"]] },
    ];

    // ---- Simple helpers ----
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

    function titleize(p){
      if(p === "/") return "Home";
      const clean = p.replace(/^\//,"").replace(/<|>/g,"")
      return clean.split("/").map(x=>x.replace(/[-_]/g," ")).join(" → ")
    }

    function paramTemplate(params){
      if(!params || !params.length) return "-";
      return params.map(([k,v])=>`${k}:${v}`).join(", ");
    }

    function defaultBody(params){
      const obj = {};
      params.filter(p=>p[0]==='json').forEach(([_,k])=>{
        if(k==='jwt') obj[k] = $('#jwtInput').value || "<your-jwt>";
        else if(k==='email') obj[k] = "user@example.com";
        else if(k==='otp') obj[k] = "123456";
        else if(k==='username') obj[k] = "username";
        else if(k==='max_downvotes') obj[k] = 3;
        else if(k==='room' || k==='room_code') obj[k] = "ABCD123";
        else if(k==='song_uuid') obj[k] = "550e8400-e29b-41d4-a716-446655440001";
        else if(k==='playlist_id') obj[k] = "550e8400-e29b-41d4-a716-446655440000";
        else if(k==='name') obj[k] = "My Playlist";
        else if(k==='public') obj[k] = true;
        else if(k==='host_playing_only') obj[k] = true;
        else if(k==='song') obj[k] = {
          "artist": "The Beatles",
          "album": "Abbey Road", 
          "duration": "3:03",
          "title": "Come Together",
          "url": "jjoNDRXAJlI",
          "album_art": "https://lh3.googleusercontent.com/example=w500-h500-l90-rj"
        };
        else if(k==='songs') obj[k] = [
          {
            "artist": "The Beatles",
            "album": "Abbey Road",
            "duration": "3:03", 
            "title": "Come Together",
            "url": "jjoNDRXAJlI",
            "album_art": "https://lh3.googleusercontent.com/example=w500-h500-l90-rj"
          }
        ];
        else obj[k] = "value";
      });
      return obj;
    }

    function getExampleResponse(path, method) {
      // Return appropriate example responses based on endpoint
      if (path === "/") return '"Welcome to the PartyAux API!"';
      if (path.includes("/search/") && !path.includes("suggestions")) {
        return JSON.stringify([
          {
            "artist": "The Beatles",
            "album": "Abbey Road",
            "duration": "3:03",
            "title": "Come Together",
            "url": "jjoNDRXAJlI",
            "album_art": "https://lh3.googleusercontent.com/2Vgf8V5t2S4cOzGjX8E8YPdLuv_fN5lXZhFjA5AQdS4cOzGjX8E8YPdLuv_fN5lXZhFjA5A=w500-h500-l90-rj"
          }
        ], null, 2);
      }
      if (path.includes("/search/suggestions/")) {
        return JSON.stringify({
          "input": "query",
          "suggestions": [
            {
              "complete_query": {"query": "beatles help"},
              "completion_parts": [{"text": "beatles "}, {"text": "help", "bold": true}]
            }
          ]
        }, null, 2);
      }
      if (path.includes("/search-playlists/")) {
        return JSON.stringify({
          "status": "Playlists retrieved",
          "playlists": [
            {
              "_id": "507f1f77bcf86cd799439011",
              "name": "Party Mix",
              "owner": "user@example.com",
              "owner_username": "username",
              "playlist_id": "550e8400-e29b-41d4-a716-446655440000",
              "public": true
            }
          ]
        }, null, 2);
      }
      if (path === "/send-otp") {
        return JSON.stringify({"message": "OTP sent successfully"}, null, 2);
      }
      if (path === "/login") {
        return JSON.stringify({
          "message": "OTP verified successfully",
          "jwt": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20ifQ.example_signature"
        }, null, 2);
      }
      if (path === "/exists") {
        return JSON.stringify({"exists": true}, null, 2);
      }
      if (path === "/create-signup") {
        return JSON.stringify({"status": "Account created successfully"}, null, 2);
      }
      if (path === "/create-room") {
        return JSON.stringify({
          "status": "Room created successfully",
          "code": "ABCD123"
        }, null, 2);
      }
      if (path === "/add-song-to-queue") {
        return JSON.stringify({"status": "Song added to queue"}, null, 2);
      }
      if (path === "/remove-song-from-queue") {
        return JSON.stringify({"status": "Song removed from queue"}, null, 2);
      }
      if (path === "/next-song") {
        return JSON.stringify({"status": "Song skipped"}, null, 2);
      }
      if (path === "/get-queue") {
        return JSON.stringify({
          "status": "Queue retrieved",
          "queue": [
            {
              "uuid": "550e8400-e29b-41d4-a716-446655440001",
              "artist": "The Beatles",
              "album": "Abbey Road",
              "duration": "3:03",
              "title": "Come Together",
              "url": "jjoNDRXAJlI",
              "album_art": "https://lh3.googleusercontent.com/example=w500-h500-l90-rj",
              "added_by": "username",
              "downvotes": ["user1@example.com"]
            }
          ]
        }, null, 2);
      }
      if (path === "/get-current-song") {
        return JSON.stringify({
          "status": "Current song retrieved",
          "song": {
            "uuid": "550e8400-e29b-41d4-a716-446655440001",
            "artist": "The Beatles",
            "album": "Abbey Road", 
            "duration": "3:03",
            "title": "Come Together",
            "url": "jjoNDRXAJlI",
            "album_art": "https://lh3.googleusercontent.com/example=w500-h500-l90-rj",
            "added_by": "username",
            "downvotes": []
          }
        }, null, 2);
      }
      if (path === "/add-downvote") {
        return JSON.stringify({
          "status": "Downvote added",
          "downvotes": 2
        }, null, 2);
      }
      if (path === "/get-room-info") {
        return JSON.stringify({
          "status": "Room info retrieved",
          "room_info": {
            "_id": {"$oid": "507f1f77bcf86cd799439011"},
            "code": "ABCD123",
            "host": {"email": "host@example.com", "username": "hostname"},
            "created_at": {"$date": "2025-01-01T12:00:00.000Z"},
            "current_song": {},
            "queue": [],
            "max_downvotes": 3,
            "host_playing_only": true,
            "users": [{"email": "user@example.com", "username": "username"}]
          }
        }, null, 2);
      }
      if (path === "/change-max-downvotes") {
        return JSON.stringify({"status": "Max downvotes changed"}, null, 2);
      }
      if (path === "/create-playlist") {
        return JSON.stringify({
          "status": "Playlist created successfully",
          "playlist_id": "550e8400-e29b-41d4-a716-446655440000"
        }, null, 2);
      }
      if (path === "/get-playlist-info") {
        return JSON.stringify({
          "status": "Playlist info retrieved",
          "playlist": {
            "_id": "507f1f77bcf86cd799439011",
            "playlist_id": "550e8400-e29b-41d4-a716-446655440000",
            "name": "My Playlist",
            "owner": "user@example.com",
            "owner_username": "username",
            "public": false,
            "songs": [
              {
                "artist": "The Beatles",
                "album": "Abbey Road",
                "duration": "3:03", 
                "title": "Come Together",
                "url": "jjoNDRXAJlI",
                "album_art": "https://lh3.googleusercontent.com/example=w500-h500-l90-rj"
              }
            ]
          }
        }, null, 2);
      }
      if (path === "/get-user-playlists") {
        return JSON.stringify({
          "status": "User playlists retrieved",
          "playlist_ids": ["550e8400-e29b-41d4-a716-446655440000", "550e8400-e29b-41d4-a716-446655440001"]
        }, null, 2);
      }
      if (path === "/update-playlist") {
        return JSON.stringify({"status": "Playlist updated successfully"}, null, 2);
      }
      if (path === "/change-playlist-visibility") {
        return JSON.stringify({"status": "Playlist visibility changed successfully"}, null, 2);
      }
      if (path === "/change-host-playing-only") {
        return JSON.stringify({"status": "Host playing only changed successfully"}, null, 2);
      }
      
      // Default success response
      return JSON.stringify({
        "status": "Operation successful"
      }, null, 2);
    }

    function exampleCurl(base, method, path, params){
      const url = new URL((base||'').replace(/\/$/,''));
      const hasPathParam = /<[^>]+>/.test(path);
      let finalPath = path;
      if(hasPathParam){
        finalPath = path.replace(/<([^>]+)>/g, (m,k)=>{
          const guess = k.includes('query')? 'beatles' : (k.includes('playlist_name')? 'party' : 'value');
          return guess;
        });
      }
      url.pathname = (url.pathname.replace(/\/$/,'')) + finalPath;
      const body = defaultBody(params);
      const hasJSON = params.some(p=>p[0]==='json');
      const hasQuery = params.some(p=>p[0]==='query');
      if(hasQuery){
        params.filter(p=>p[0]==='query').forEach(([_,k])=>{
          url.searchParams.set(k, k.includes('room')? 'ABCD123' : (k.includes('playlist')? 'playlist_id' : (k==='jwt' ? ($('#jwtInput').value||'<your-jwt>') : 'value')));
        });
      }
      const lines = [
        `curl -X ${method} "${url.toString()||'https://api.example.com'}"` + (hasJSON?` \\\n  -H 'Content-Type: application/json' \\\n  -d '${JSON.stringify(body,null,0)}'`: '')
      ];
      return lines.join("\n");
    }

    function exampleFetch(base, method, path, params){
      const hasJSON = params.some(p=>p[0]==='json');
      const curl = exampleCurl(base, method, path, params);
      const urlLine = curl.split("\n")[0].match(/\"(.*)\"/)[1];
      return `fetch('${urlLine}', {\n  method: '${method}',${hasJSON?"\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify("+JSON.stringify(defaultBody(params),null,2)+")":''}\n}).then(r=>r.json()).then(console.log)`
    }

    function copy(text){
      navigator.clipboard.writeText(text).then(()=>{
        // Optional: toast
      });
    }

    function render(){
      const list = $('#endpoints');
      list.innerHTML = '';
      const q = ($('#search').value||'').toLowerCase();
      const fm = $('#filterMethod').value;
      const base = $('#baseUrl').value || 'http://35.208.64.59';

      const filtered = ENDPOINTS.filter(e=>{
        const hay = [e.path, e.methods.join(','), ...e.params.map(p=>p.join(':'))].join(' ').toLowerCase();
        const okQ = q? hay.includes(q) : true;
        const okM = fm? e.methods.includes(fm) : true;
        return okQ && okM;
      });

      $('#countBadge').textContent = `${filtered.length} endpoint${filtered.length!==1?'s':''}`;

      filtered.forEach(e=>{
        e.methods.forEach(method=>{
          const id = (method+e.path).replace(/[^a-z0-9]/gi,'_');
          const det = document.createElement('details');
          det.className = 'endpoint';
          det.id = id;
          det.innerHTML = `
            <summary>
              <div class="method ${method}">${method}</div>
              <div class="path">${e.path}</div>
              <div class="chev">▾</div>
            </summary>
            <div class="content">
              <div class="section">
                <h4>Overview</h4>
                <div class="kvs">
                  <div class="kv"><b>Path:</b> ${e.path}</div>
                  <div class="kv"><b>Method:</b> ${method}</div>
                  <div class="kv"><b>Params:</b> ${paramTemplate(e.params)}</div>
                </div>
              </div>

              <div class="section two-col">
                <div>
                  <h4>cURL</h4>
                  <pre><code id="curl_${id}">${exampleCurl(base, method, e.path, e.params)}</code></pre>
                  <button class="copy" data-copy="curl_${id}">Copy</button>
                </div>
                <div>
                  <h4>fetch()</h4>
                  <pre><code id="fetch_${id}">${exampleFetch(base, method, e.path, e.params)}</code></pre>
                  <button class="copy" data-copy="fetch_${id}">Copy</button>
                </div>
              </div>

              <div class="section two-col">
                <div>
                  <h4>Request Body (JSON)</h4>
                  <pre><code>${e.params.length ? JSON.stringify(defaultBody(e.params), null, 2) : "No request body required"}</code></pre>
                </div>
                <div>
                  <h4>Example Response</h4>
                  <pre><code>${getExampleResponse(e.path, method)}</code></pre>
                </div>
              </div>

              <div class="section">
                <h4>Notes</h4>
                <ul style="margin:0 0 0 18px;color:var(--muted)">
                  <li>Authentication required endpoints need a valid JWT token in the request body.</li>
                  <li>Room codes are 6-character alphanumeric strings (e.g., "ABCD123").</li>
                  <li>Song objects include: artist, album, duration, title, url (YouTube video ID), and album_art (image URL).</li>
                  <li>UUIDs are generated automatically for songs and playlists.</li>
                  <li>Queue songs include additional fields: uuid, added_by (username), and downvotes (array of emails).</li>
                </ul>
              </div>
            </div>`;
          list.appendChild(det);
        })
      });
    }

    document.addEventListener('click', (e)=>{
      if(e.target.matches('.copy')){
        const id = e.target.getAttribute('data-copy');
        const text = document.getElementById(id).innerText;
        copy(text);
        e.target.textContent = 'Copied';
        setTimeout(()=> e.target.textContent = 'Copy', 1200);
      }
    });

    $('#search').addEventListener('input', render);
    $('#filterMethod').addEventListener('change', render);
    $('#baseUrl').addEventListener('input', render);
    $('#jwtInput').addEventListener('input', render);

    $('#expandAll').addEventListener('click', ()=> $$('#endpoints details').forEach(d=> d.open=true));
    $('#collapseAll').addEventListener('click', ()=> $$('#endpoints details').forEach(d=> d.open=false));

    render();
  </script>
</body>
</html>
